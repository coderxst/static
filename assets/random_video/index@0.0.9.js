class RandomVideo{#e="https://api.coderxst.top/dogecloud/randomVideo";#t="上一个";#n="下一个";#i="点击打开休闲视频";#s="关闭视频";#o="连续: 开";#r="连续: 关";#a="循环: 开";#d="循环: 关";#l="当前浏览器不支持使用video播放视频, 请升级或者更换浏览器播放视频!";#c="https://bu.dusays.com/2023/09/29/6516c8691e866.gif";#h="我也是有上限的哦🥰";#E=.6;#v=null;#u=null;#O=null;#L=!0;#m=!1;#p=!1;#C=null;#y=[{key:"sister",label:"小姐姐",currentIndex:-1,list:[]},{key:"funny",label:"搞笑视频",currentIndex:-1,list:[]}];#_="";#T=!0;#P=null;constructor(){this.#_=this.#y[0].key}run(e){this.#v=e??this.#v,this.#v&&(this.#v.querySelector("#random-video-container")||(this.#u?this.#v.appendChild(this.#u):(this.#C||this.#g(),this.render())))}async#b(e){const t=this.#e+`?category=${e}`;try{const e=await fetch(t),n=await e.json();return n.data?n.data:""}catch(e){console.error(e)}}#N(){const e=document.createElement("div");e.className="tab-bar";const t=document.createElement("div");t.className="tab-bar-list";let n=null;const i=()=>{const e=this.#y.find((e=>e.key===this.#_));if(!e)return;const{list:t,currentIndex:n}=e;t.length>0?(this.#O.src=t[n],this.#O.play()):this.nextBtnClick()},s=()=>{i(),this.#O.removeEventListener("loadeddata",s)};return this.#y.forEach((e=>{const o=document.createElement("div");o.dataset.key=e.key;let r="";e.key===this.#_&&(r="active",n=o),o.className=`tab-bar-item ${r}`;const a=document.createElement("span");a.className="tab-bar-item-text",a.innerText=e.label,a.addEventListener("click",(e=>{const t=e.target.parentElement;t.classList.contains("tab-bar-item")&&n!==t&&(n.classList.remove("active"),t.classList.add("active"),this.#_=t.dataset.key,n=t,4===this.#O.readyState?i():this.#O.addEventListener("loadeddata",s))})),o.appendChild(a),t.appendChild(o)})),e.appendChild(t),e}#S(){const e=document.createElement("div");e.className="btns";return[{className:"btn continuous",innerText:this.#o,eventHandleFn:this.continuousBtnClick},{className:"btn loop",innerText:this.#d,eventHandleFn:this.loopBtnClick},{className:"btn previous",innerText:this.#t,eventHandleFn:this.previousBtnClick},{className:"btn next",innerText:this.#n,eventHandleFn:this.nextBtnClick}].forEach((t=>{const n=this.#x(t);e.appendChild(n)})),e}#V(){return this.#x({className:"open-close",innerText:this.#i,eventHandleFn:this.openAndCloseBtnClick})}#x(e){const t=document.createElement("button");return t.className=e.className,t.innerText=e.innerText,t.addEventListener("click",(t=>{e.eventHandleFn.call(this,t)})),t}continuousBtnClick(e){if(this.#L)e.target.innerText=this.#r;else{this.#u.querySelector(".loop").innerText=this.#d,this.#p=!1,e.target.innerText=this.#o}this.#L=!this.#L}loopBtnClick(e){if(this.#p)e.target.innerText=this.#d;else{this.#u.querySelector(".continuous").innerText=this.#r,this.#L=!1,e.target.innerText=this.#a}this.#p=!this.#p}previousBtnClick(){const e=this.#y.find((e=>e.key===this.#_));if(!e)return;const{currentIndex:t,list:n}=e;0!==t?(t>0&&this.#I(!0),this.#O.src=n[t-1],this.#O.play(),e.currentIndex--):this.#P()}async nextBtnClick(){this.#I(!0);let e="";const t=this.#y.find((e=>e.key===this.#_));if(!t)return;const{currentIndex:n,list:i}=t;n<i.length-1?e=i[n+1]:(e=await this.#b(this.#_),t.list.push(e)),this.#O.src=e,this.#m&&this.#O.play(),t.currentIndex++}openAndCloseBtnClick(e){if(e.observer&&!this.#m)return;const t=this.#u.querySelector(".content"),n=()=>{this.#O.pause(),this.#O.removeEventListener("canplay",n)};this.#m?(t.classList.remove("open"),4===this.#O.readyState?this.#O.pause():this.#O.addEventListener("canplay",n),e.target.innerText=this.#i):(t.classList.add("open"),this.#O.play(),e.target.innerText=this.#s),this.#m=!this.#m}async#A(){const e=document.createElement("div");e.className="video-box",e.style.setProperty("--poster-image",`url("${this.#c}")`),this.#O=document.createElement("video"),this.#O.controls=!0,this.#O.innerText=this.#l,this.nextBtnClick();const t=()=>{this.#O.style.height="auto",this.#O.height;const e=this.#O.getBoundingClientRect().height;this.#O.style.height=e+"px"};this.#O.addEventListener("loadeddata",(()=>{this.#I(!1),t()})),this.#O.addEventListener("ended",(()=>{this.#L?this.nextBtnClick():this.#p&&this.#O.play()})),this.#O.addEventListener("fullscreenchange",(()=>{t()})),this.#C.observe(this.#O);const n=this.#k();return e.append(this.#O,n),e}#k(){const e=document.createElement("div");return e.className="video-tip",e.innerText=this.#h,e.addEventListener("animationend",(()=>{e.classList.remove("active")})),this.#P=t=>{e.classList.contains("active")||(e.classList.add("active"),t&&(e.innerText=t))},e}#g(){this.#C=new IntersectionObserver((e=>{e[0].isIntersecting||this.openAndCloseBtnClick({target:this.#u.querySelector(".open-close"),observer:!0})}),{threshold:this.#E})}#I(e){this.#T=e,this.#T?this.#u.setAttribute("data-loading","true"):this.#u.removeAttribute("data-loading")}async render(){if(!this.#v)return;this.#u=document.createElement("div"),this.#u.id="random-video-container";const e=document.createElement("div");e.className="content";const t=this.#N(),n=await this.#A(),i=this.#S();e.append(t,n,i);const s=this.#V();this.#u.append(e,s),this.#v.appendChild(this.#u)}consumer(e){e(this)}}(new RandomVideo).consumer((e=>{const t=()=>{const t=document.querySelector("#card-random-video .item-content");e.run(t)};document.addEventListener("DOMContentLoaded",t),document.addEventListener("pjax:complete",t)}));