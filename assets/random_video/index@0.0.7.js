class RandomVideo{#e="https://coderxst.top:8001/dogecloud";#t="上一个";#i="下一个";#n="点击打开休闲视频";#s="关闭视频";#o="连续: 开";#r="连续: 关";#d="循环: 开";#a="循环: 关";#l="当前浏览器不支持使用video播放视频, 请升级或者更换浏览器播放视频!";#h="https://bu.dusays.com/2023/09/29/6516c8691e866.gif";#c="我也是有上限的哦🥰";#E=null;#u=null;#O=null;#v=!0;#L=!1;#p=!1;#m=null;#C=[];#P=-1;#_=!0;#T=null;run(e){this.#E=e??this.#E,this.#E&&(this.#E.querySelector("#random-video-container")||(this.#u?this.#E.appendChild(this.#u):(this.#m||this.#x(),this.render())))}async#N(){const e=await fetch(this.#e).catch((e=>console.log(e))),t=await e.json();return t.data?t.data:""}#I(){const e=document.createElement("div");e.className="btns";return[{className:"btn continuous",innerText:this.#o,eventHandleFn:this.continuousBtnClick},{className:"btn loop",innerText:this.#a,eventHandleFn:this.loopBtnClick},{className:"btn previous",innerText:this.#t,eventHandleFn:this.previousBtnClick},{className:"btn next",innerText:this.#i,eventHandleFn:this.nextBtnClick}].forEach((t=>{const i=this.#V(t);e.appendChild(i)})),e}#g(){return this.#V({className:"open-close",innerText:this.#n,eventHandleFn:this.openAndCloseBtnClick})}#V(e){const t=document.createElement("button");return t.className=e.className,t.innerText=e.innerText,t.addEventListener("click",(t=>{e.eventHandleFn.call(this,t)})),t}continuousBtnClick(e){if(this.#v)e.target.innerText=this.#r;else{this.#u.querySelector(".loop").innerText=this.#a,this.#p=!1,e.target.innerText=this.#o}this.#v=!this.#v}loopBtnClick(e){if(this.#p)e.target.innerText=this.#a;else{this.#u.querySelector(".continuous").innerText=this.#r,this.#v=!1,e.target.innerText=this.#d}this.#p=!this.#p}previousBtnClick(){if(this.#P>0&&this.#S(!0),0===this.#P)return this.#T(),this.#C[this.#P];this.#O.src=this.#C[--this.#P],this.#O.play()}async nextBtnClick(){this.#S(!0);let e="";this.#P<this.#C.length-1?e=this.#C[this.#P+1]:(e=await this.#N(),this.#C.push(e)),this.#O.src=e,this.#O.play(),this.#P++}openAndCloseBtnClick(e){if(e.observer&&!this.#L)return;const t=this.#u.querySelector(".content");this.#L?(t.classList.remove("open"),this.#O.pause(),e.target.innerText=this.#n):(t.classList.add("open"),this.#O.play(),e.target.innerText=this.#s),this.#L=!this.#L}async#y(){const e=document.createElement("div");e.className="video-box",e.style.setProperty("--poster-image",`url("${this.#h}")`);const t=await this.#N();this.#C.push(t),this.#P++,this.#S(!0),this.#O=document.createElement("video"),this.#O.controls=!0,this.#O.src=t,this.#O.innerText=this.#l,this.#O.addEventListener("loadeddata",(()=>{this.#S(!1),this.#O.style.height="auto",this.#O.height;const e=this.#O.getBoundingClientRect().height;this.#O.style.height=e+"px"})),this.#O.addEventListener("ended",(()=>{this.#v?this.nextBtnClick():this.#p&&this.#O.play()})),this.#m.observe(this.#O);const i=this.#A();return e.append(this.#O,i),e}#A(){const e=document.createElement("div");return e.className="video-tip",e.innerText=this.#c,e.addEventListener("animationend",(()=>{e.classList.remove("active")})),this.#T=t=>{e.classList.add("active"),t&&(e.innerText=t)},e}#x(){this.#m=new IntersectionObserver((e=>{e[0].isIntersecting||this.openAndCloseBtnClick({target:this.#u.querySelector(".open-close"),observer:!0})}),{threshold:.6})}#S(e){this.#_=e,this.#_?this.#u.setAttribute("data-loading","true"):this.#u.removeAttribute("data-loading")}async render(){if(!this.#E)return;this.#u=document.createElement("div"),this.#u.id="random-video-container";const e=document.createElement("div");e.className="content";const t=await this.#y(),i=this.#I();e.append(t,i);const n=this.#g();this.#u.append(e,n),this.#E.appendChild(this.#u)}consumer(e){e(this)}}(new RandomVideo).consumer((e=>{const t=()=>{const t=document.querySelector("#card-random-video .item-content");e.run(t)};document.addEventListener("DOMContentLoaded",t),document.addEventListener("pjax:complete",t)}));